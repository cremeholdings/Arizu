"use strict";(()=>{var e={};e.id=172,e.ids=[172],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},98216:e=>{e.exports=require("net")},55315:e=>{e.exports=require("path")},35816:e=>{e.exports=require("process")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},76109:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>T,requestAsyncStorage:()=>E,routeModule:()=>P,serverHooks:()=>I,staticGenerationAsyncStorage:()=>A});var s={};r.r(s),r.d(s,{POST:()=>x});var i=r(49303),n=r(88716),o=r(60670),a=r(87070),l=r(96471),c=r(21067);let p=require("fs");var u=r(55315),m=r(70907);let h=(0,p.readFileSync)((0,u.join)(process.cwd(),"lib/llm/system-prompts/planner.txt"),"utf-8"),d={anthropic:{name:"anthropic",async generateResponse(e,t){let r=process.env.ANTHROPIC_API_KEY;if(!r)throw Error("ANTHROPIC_API_KEY environment variable is required");let s=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":r,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-5-sonnet-20241022",max_tokens:4096,system:e,messages:[{role:"user",content:t}],temperature:.1})});if(!s.ok){let e=await s.text();throw Error(`Anthropic API error: ${s.status} ${s.statusText} - ${e}`)}let i=await s.json();if(!i.content||!Array.isArray(i.content)||0===i.content.length)throw Error("Invalid response format from Anthropic API");let n=i.content.find(e=>"text"===e.type);if(!n)throw Error("No text content found in Anthropic API response");return n.text}},openai:{name:"openai",async generateResponse(e,t){let r=process.env.OPENAI_API_KEY;if(!r)throw Error("OPENAI_API_KEY environment variable is required");let s=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:"gpt-4o",messages:[{role:"system",content:e},{role:"user",content:t}],temperature:.1,max_tokens:4096,response_format:{type:"json_object"}})});if(!s.ok){let e=await s.text();throw Error(`OpenAI API error: ${s.status} ${s.statusText} - ${e}`)}let i=await s.json();if(!i.choices||!Array.isArray(i.choices)||0===i.choices.length)throw Error("Invalid response format from OpenAI API");let n=i.choices[0];if(!n.message||!n.message.content)throw Error("No content found in OpenAI API response");return n.message.content}},google:{name:"google",async generateResponse(e,t){let r=process.env.GOOGLE_API_KEY;if(!r)throw Error("GOOGLE_API_KEY environment variable is required");let s=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`${e}

User request: ${t}`}]}],generationConfig:{temperature:.1,maxOutputTokens:4096,responseMimeType:"application/json"}})});if(!s.ok){let e=await s.text();throw Error(`Google API error: ${s.status} ${s.statusText} - ${e}`)}let i=await s.json();if(!i.candidates||!Array.isArray(i.candidates)||0===i.candidates.length)throw Error("Invalid response format from Google API");let n=i.candidates[0];if(!n.content||!n.content.parts||!Array.isArray(n.content.parts))throw Error("No content found in Google API response");let o=n.content.parts.find(e=>e.text);if(!o)throw Error("No text content found in Google API response");return o.text}},mistral:{name:"mistral",async generateResponse(e,t){let r=process.env.MISTRAL_API_KEY;if(!r)throw Error("MISTRAL_API_KEY environment variable is required");let s=await fetch("https://api.mistral.ai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:"mistral-large-latest",messages:[{role:"system",content:e},{role:"user",content:t}],temperature:.1,max_tokens:4096,response_format:{type:"json_object"}})});if(!s.ok){let e=await s.text();throw Error(`Mistral API error: ${s.status} ${s.statusText} - ${e}`)}let i=await s.json();if(!i.choices||!Array.isArray(i.choices)||0===i.choices.length)throw Error("Invalid response format from Mistral API");let n=i.choices[0];if(!n.message||!n.message.content)throw Error("No content found in Mistral API response");return n.message.content}}};async function g({prompt:e,orgId:t,maxRetries:r=3}){let s=function(){let e=process.env.MODEL_PROVIDER||"anthropic",t=d[e];if(!t)throw Error(`Unknown MODEL_PROVIDER: ${e}. Available providers: ${Object.keys(d).join(", ")}`);return t}(),i=[];console.log("Generating plan",{provider:s.name,orgId:t.slice(0,8)+"...",promptLength:e.length,promptPreview:e.slice(0,100).replace(/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,"[EMAIL]").replace(/\b(?:sk|pk)_[a-zA-Z0-9]{32,}\b/g,"[API_KEY]").replace(/\b(?:Bearer\s+)[a-zA-Z0-9_-]+/g,"Bearer [TOKEN]")+"..."});for(let o=1;o<=r;o++)try{var n;let a,l=e;o>1&&i.length>0&&(l=`${e}

Previous attempt failed validation with these errors:
${i.map(e=>`- ${e}`).join("\n")}

Please fix these issues and return valid JSON.`);let c=(n=l,`${n}

You must return ONLY valid JSON matching the Plan schema. No prose, explanations, or markdown. Just the JSON object.`);console.log(`Plan generation attempt ${o}/${r}`,{orgId:t.slice(0,8)+"...",provider:s.name,promptLength:c.length});let p=await s.generateResponse(h,c),u=function(e){let t=e.match(/```(?:json)?\s*(\{[\s\S]*?\})\s*```/);if(t)return t[1];let r=e.trim();if(r.startsWith("{")&&r.endsWith("}"))return r;let s=e.match(/\{[\s\S]*\}/);return s?s[0]:e}(p);try{a=JSON.parse(u)}catch(e){i=[`Invalid JSON format: ${e instanceof Error?e.message:"Unknown error"}`],console.warn(`JSON parse failed on attempt ${o}`,{orgId:t.slice(0,8)+"...",error:e instanceof Error?e.message:"Unknown error",responsePreview:p.slice(0,200)+"..."});continue}let d=(0,m.NH)(a);if(d.valid)return console.log(`Plan generated successfully on attempt ${o}`,{orgId:t.slice(0,8)+"...",planName:d.data?.name,stepCount:d.data?.steps.length}),{success:!0,plan:d.data,attempts:o};i=d.errors,console.warn(`Plan validation failed on attempt ${o}`,{orgId:t.slice(0,8)+"...",errors:d.errors})}catch(r){let e=r instanceof Error?r.message:"Unknown error";i=[`Provider error: ${e}`],console.error(`Plan generation error on attempt ${o}`,{orgId:t.slice(0,8)+"...",provider:s.name,error:e})}return console.error(`Plan generation failed after ${r} attempts`,{orgId:t.slice(0,8)+"...",provider:s.name,finalErrors:i}),{success:!1,errors:i.length>0?i:["Failed to generate valid plan"],attempts:r}}var f=r(55227),w=r(60077);let y=c.Ry({prompt:c.Z_().min(10).max(2e3)});async function x(e){try{let{userId:t,orgId:r}=(0,l.I8)();if(!t||!r)return a.NextResponse.json({ok:!1,error:"Authentication required"},{status:401});let s=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"127.0.0.1",i=await (0,f.Iy)("PLAN_GENERATE","/api/plan",{ip:s,orgId:r,userId:t});if((0,f.V1)(i)){let e=(0,f.dK)(i);return console.warn("Plan generation rate limited",{userId:t.slice(0,8)+"...",orgId:r.slice(0,8)+"...",ip:s,limit:e.limit,remaining:e.remaining,retryAfter:e.retryAfter}),a.NextResponse.json({ok:!1,code:"RATE_LIMIT",error:"Rate limit exceeded",limit:e.limit,remaining:e.remaining,resetTime:e.resetTime},{status:429,headers:{"Retry-After":String(e.retryAfter||60),"X-RateLimit-Limit":String(e.limit),"X-RateLimit-Remaining":String(e.remaining),"X-RateLimit-Reset":String(e.resetTime)}})}let n=function(){let e=(({anthropic:["ANTHROPIC_API_KEY"],openai:["OPENAI_API_KEY"],google:["GOOGLE_API_KEY"],mistral:["MISTRAL_API_KEY"]})[process.env.MODEL_PROVIDER||"anthropic"]||[]).filter(e=>!process.env[e]);return{valid:0===e.length,missing:e}}();if(!n.valid)return console.error("LLM environment validation failed",{missing:n.missing}),a.NextResponse.json({ok:!1,error:"Service configuration error"},{status:500});let o=await e.json(),c=y.safeParse(o);if(!c.success)return a.NextResponse.json({ok:!1,error:"Invalid request",issues:c.error.issues.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});let{prompt:p}=c.data;console.log("Plan generation request",{userId:t.slice(0,8)+"...",orgId:r.slice(0,8)+"...",promptLength:p.length});let u=await (0,w.lI)(`llm-plan-${r}`,"LLM_API",()=>g({prompt:p,orgId:r,maxRetries:3}));if(!u.success)return console.warn("Plan generation failed",{userId:t.slice(0,8)+"...",orgId:r.slice(0,8)+"...",attempts:u.attempts,errors:u.errors}),a.NextResponse.json({ok:!1,error:"Failed to generate valid plan",issues:u.errors||["Unknown error occurred"],suggestion:"Try rephrasing your request or being more specific about the automation steps you need."},{status:422});let h=(0,m.NH)(u.plan);if(!h.valid)return console.error("Final plan validation failed unexpectedly",{userId:t.slice(0,8)+"...",orgId:r.slice(0,8)+"...",errors:h.errors}),a.NextResponse.json({ok:!1,error:"Generated plan failed validation",issues:h.errors,suggestion:"Try rephrasing your request with different wording."},{status:422});return console.log("Plan generated successfully",{userId:t.slice(0,8)+"...",orgId:r.slice(0,8)+"...",planName:u.plan.name,stepCount:u.plan.steps.length,attempts:u.attempts}),a.NextResponse.json({ok:!0,plan:u.plan,meta:{attempts:u.attempts,stepCount:u.plan.steps.length}})}catch(e){if(e instanceof w.ZN)return console.warn("Plan API circuit breaker triggered",{error:e.message,state:e.state,lastError:e.lastError?.message}),a.NextResponse.json({ok:!1,code:"CIRCUIT_OPEN",error:"Service temporarily unavailable",suggestion:"The LLM service is experiencing issues. Please try again in a few minutes.",state:e.state},{status:503,headers:{"Retry-After":"30"}});return console.error("Plan API error",{error:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),a.NextResponse.json({ok:!1,error:"Internal server error",suggestion:"Please try again in a moment. If the problem persists, contact support."},{status:500})}}let P=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/plan/route",pathname:"/api/plan",filename:"route",bundlePath:"app/api/plan/route"},resolvedPagePath:"/Users/ediyaffe/Documents/GitHub/Arizu/app/api/plan/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:E,staticGenerationAsyncStorage:A,serverHooks:I}=P,v="/api/plan/route";function T(){return(0,o.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:A})}},60077:(e,t,r)=>{var s;r.d(t,{ZN:()=>i,lI:()=>l}),function(e){e.CLOSED="closed",e.OPEN="open",e.HALF_OPEN="half-open"}(s||(s={}));class i extends Error{constructor(e,t,r){super(e),this.state=t,this.lastError=r,this.name="CircuitBreakerError"}}class n{constructor(e,t){this.name=e,this.config=t,this.state="closed",this.failures=0,this.requests=0,this.lastFailureTime=0,this.nextAttemptTime=0,this.recentErrors=[]}async execute(e){let t=Date.now(),r=0;for(;r<this.config.maxRetries;){r++;try{await this.checkState();let s=await this.executeWithTimeout(e);return this.onSuccess(),console.log("Circuit breaker success:",{name:this.name,state:this.state,attempts:r,totalTime:Date.now()-t}),s}catch(s){if(this.onFailure(s),"open"===this.state||r>=this.config.maxRetries)throw console.error("Circuit breaker failure:",{name:this.name,state:this.state,attempts:r,totalTime:Date.now()-t,error:s instanceof Error?s.message:"Unknown error"}),s;let e=this.calculateRetryDelay(r);await this.sleep(e),console.warn("Circuit breaker retry:",{name:this.name,attempt:r,delay:e,error:s instanceof Error?s.message:"Unknown error"})}}throw new i(`Circuit breaker ${this.name} failed after ${r} attempts`,this.state)}async checkState(){let e=Date.now();switch(this.state){case"closed":if(this.cleanupOldErrors(e),this.requests>=this.config.minimumRequests){let t=this.failures/this.requests;if(t>=this.config.errorPercentageThreshold/100)throw this.transitionToOpen(e),new i(`Circuit breaker ${this.name} opened due to high error rate: ${(100*t).toFixed(1)}%`,"open")}break;case"open":if(e>=this.nextAttemptTime)this.transitionToHalfOpen();else{let t=this.nextAttemptTime-e;throw new i(`Circuit breaker ${this.name} is open. Next attempt in ${t}ms`,"open")}}}async executeWithTimeout(e){let t=new Promise((e,t)=>{setTimeout(()=>{t(Error(`Operation timeout after ${this.config.resetTimeoutMs}ms`))},this.config.resetTimeoutMs)});return Promise.race([e(),t])}onSuccess(){this.requests++,"half-open"===this.state&&this.transitionToClosed(),this.cleanupOldErrors(Date.now()),console.log("Circuit breaker request success:",{name:this.name,state:this.state,requests:this.requests,failures:this.failures})}onFailure(e){let t=Date.now();this.requests++,this.failures++,this.lastFailureTime=t,this.recentErrors.push({timestamp:t,error:e instanceof Error?e.message:"Unknown error"}),this.recentErrors=this.recentErrors.slice(-10),"half-open"===this.state&&this.transitionToOpen(t),console.warn("Circuit breaker request failure:",{name:this.name,state:this.state,requests:this.requests,failures:this.failures,error:e instanceof Error?e.message:"Unknown error"})}transitionToOpen(e){this.state="open",this.nextAttemptTime=e+this.config.resetTimeoutMs,console.warn("Circuit breaker opened:",{name:this.name,failures:this.failures,requests:this.requests,errorRate:(this.failures/this.requests*100).toFixed(1)+"%",nextAttemptTime:new Date(this.nextAttemptTime).toISOString()})}transitionToHalfOpen(){this.state="half-open",console.log("Circuit breaker transitioning to half-open:",{name:this.name,failures:this.failures,requests:this.requests})}transitionToClosed(){this.state="closed",this.failures=0,this.requests=0,this.recentErrors=[],console.log("Circuit breaker closed:",{name:this.name,resetSuccessful:!0})}cleanupOldErrors(e){let t=e-this.config.monitoringPeriodMs;this.recentErrors=this.recentErrors.filter(e=>e.timestamp>t);let r=this.failures;this.failures=this.recentErrors.length,0===this.recentErrors.length&&(this.requests=0),r!==this.failures&&console.log("Circuit breaker cleaned up old errors:",{name:this.name,oldFailures:r,newFailures:this.failures,requests:this.requests})}calculateRetryDelay(e){return Math.min(this.config.baseDelayMs*Math.pow(2,e-1),this.config.maxDelayMs)+Math.random()*this.config.jitterMs}sleep(e){return new Promise(t=>setTimeout(t,e))}getState(){return{state:this.state,failures:this.failures,requests:this.requests,lastFailureTime:this.lastFailureTime,nextAttemptTime:this.nextAttemptTime,recentErrors:[...this.recentErrors]}}getHealthCheck(){let e=this.requests>0?this.failures/this.requests*100:0,t="closed"===this.state&&e<this.config.errorPercentageThreshold,r="open"!==this.state;return{healthy:t,state:this.state,errorRate:e,uptime:r}}forceOpen(){this.state="open",this.nextAttemptTime=Date.now()+this.config.resetTimeoutMs,console.warn("Circuit breaker manually forced open:",{name:this.name})}forceClose(){this.transitionToClosed(),console.log("Circuit breaker manually forced closed:",{name:this.name})}reset(){this.transitionToClosed(),console.log("Circuit breaker reset:",{name:this.name})}}let o={LLM_API:{failureThreshold:5,resetTimeoutMs:3e4,monitoringPeriodMs:6e4,minimumRequests:3,errorPercentageThreshold:50,maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4,jitterMs:500},N8N_API:{failureThreshold:3,resetTimeoutMs:15e3,monitoringPeriodMs:6e4,minimumRequests:2,errorPercentageThreshold:30,maxRetries:2,baseDelayMs:500,maxDelayMs:5e3,jitterMs:250},DATABASE:{failureThreshold:10,resetTimeoutMs:1e4,monitoringPeriodMs:3e4,minimumRequests:5,errorPercentageThreshold:20,maxRetries:3,baseDelayMs:100,maxDelayMs:2e3,jitterMs:100},EXTERNAL_API:{failureThreshold:5,resetTimeoutMs:2e4,monitoringPeriodMs:6e4,minimumRequests:3,errorPercentageThreshold:40,maxRetries:2,baseDelayMs:1e3,maxDelayMs:8e3,jitterMs:500}},a=new Map;async function l(e,t,r){let s=function(e,t){if(!a.has(e)){let r=o[t];a.set(e,new n(e,r))}return a.get(e)}(e,t);return await s.execute(r)}},55227:(e,t,r)=>{r.d(t,{Iy:()=>d,V1:()=>u,dK:()=>m});var s=r(79984);class i{constructor(e){this.redisUrl=e,this.client=null,this.connecting=!1}async getClient(){if(this.client?.isOpen)return this.client;if(this.connecting)return await new Promise(e=>setTimeout(e,100)),this.getClient();try{this.connecting=!0;let e=this.redisUrl||process.env.REDIS_URL||"redis://localhost:6379";return this.client=(0,s.createClient)({url:e}),this.client.on("error",e=>{console.error("Redis rate limiter error:",{error:e instanceof Error?e.message:"Unknown error"})}),await this.client.connect(),this.connecting=!1,this.client}catch(e){throw this.connecting=!1,console.error("Failed to connect to Redis for rate limiting:",{error:e instanceof Error?e.message:"Unknown error"}),e}}async slidingWindow(e,t,r){try{let s;let i=await this.getClient(),n=Date.now(),o=1e3*r,a=i.multi();a.zRemRangeByScore(e,0,n-o),a.zCard(e),a.zAdd(e,{score:n,value:`${n}-${Math.random()}`}),a.expire(e,2*r);let l=await a.exec();if(!l)throw Error("Redis pipeline failed");let c=l[1]||0,p=c<t,u=Math.max(0,t-c-1),m=n+o;if(!p){let t=await i.zRange(e,0,0,{REV:!1});if(t.length>0){let r=await i.zScore(e,t[0]);r&&(s=Math.ceil((r+o-n)/1e3))}s=s||r}return console.log("Rate limit check:",{key:e.substring(0,20)+"...",allowed:p,currentCount:c+1,limit:t,remaining:u,windowSec:r}),{allowed:p,limit:t,remaining:u,resetTime:m,retryAfter:s}}catch(s){return console.error("Rate limiting error:",{key:e.substring(0,20)+"...",error:s instanceof Error?s.message:"Unknown error"}),{allowed:!0,limit:t,remaining:t-1,resetTime:Date.now()+1e3*r}}}async disconnect(){this.client?.isOpen&&await this.client.disconnect()}}let n=null;function o(){return n||(n=new i),n}async function a(e,t,r,s){let i=o(),n=`rate_limit:ip:${t}:${e}`;return await i.slidingWindow(n,r,s)}async function l(e,t,r,s){let i=o(),n=`rate_limit:org:${t}:${e}`;return await i.slidingWindow(n,r,s)}async function c(e,t,r,s){let i=o(),n=`rate_limit:user:${t}:${e}`;return await i.slidingWindow(n,r,s)}async function p(e,t){return await Promise.all(t.map(async t=>{switch(t.type){case"ip":return await a(e,t.id,t.max,t.windowSec);case"org":return await l(e,t.id,t.max,t.windowSec);case"user":return await c(e,t.id,t.max,t.windowSec);default:throw Error(`Unknown limit type: ${t.type}`)}}))}function u(e){return e.some(e=>!e.allowed)}function m(e){return e.find(e=>!e.allowed)||e.reduce((e,t)=>t.remaining<e.remaining?t:e)}let h={PLAN_GENERATE:{ip:{max:10,windowSec:60},org:{max:100,windowSec:3600},user:{max:20,windowSec:300}},PLAN_VALIDATE:{ip:{max:30,windowSec:60},org:{max:500,windowSec:3600},user:{max:60,windowSec:300}},DEPLOY:{ip:{max:5,windowSec:60},org:{max:50,windowSec:3600},user:{max:10,windowSec:300}},WEBHOOK_INGEST:{ip:{max:100,windowSec:60},org:{max:1e3,windowSec:3600}},HEALTH_CHECK:{ip:{max:60,windowSec:60}},API_DEFAULT:{ip:{max:100,windowSec:60},org:{max:1e3,windowSec:3600},user:{max:200,windowSec:300}}};async function d(e,t,r){let s=h[e],i=[];return s.ip&&i.push({type:"ip",id:r.ip,max:s.ip.max,windowSec:s.ip.windowSec}),s.org&&r.orgId&&i.push({type:"org",id:r.orgId,max:s.org.max,windowSec:s.org.windowSec}),s.user&&r.userId&&i.push({type:"user",id:r.userId,max:s.user.max,windowSec:s.user.windowSec}),await p(t,i)}},70907:(e,t,r)=>{r.d(t,{NH:()=>p});var s=r(19619),i=r.n(s),n=r(28586),o=r.n(n);let a={type:"object",properties:{field:{type:"string"},op:{type:"string",enum:["contains","equals","gt","lt","regex"]},value:{}},required:["field","op","value"],additionalProperties:!1},l=new(i())({allErrors:!0,verbose:!0,strict:!0,removeAdditional:!1});o()(l),l.addSchema({$id:"stepSchema",oneOf:[{type:"object",properties:{type:{type:"string",const:"trigger.http"},path:{type:"string"},secretHmac:{type:"boolean"}},required:["type","path","secretHmac"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"filter"},when:a},required:["type","when"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"action.slack.postMessage"},channel:{type:"string"},text:{type:"string"}},required:["type","channel","text"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"action.http.request"},method:{type:"string",enum:["GET","POST","PUT","DELETE"]},url:{type:"string"},headers:{type:"object",nullable:!0,additionalProperties:!0},body:{type:"object",nullable:!0,additionalProperties:!0}},required:["type","method","url"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"custom.action"},actionSlug:{type:"string"},input:{type:"object",nullable:!0,additionalProperties:!0}},required:["type","actionSlug"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"branch"},cases:{type:"array",items:{type:"object",properties:{when:a,steps:{type:"array",items:{$ref:"stepSchema"}}},required:["when","steps"],additionalProperties:!1},minItems:1},else:{type:"array",items:{$ref:"stepSchema"},nullable:!0}},required:["type","cases"],additionalProperties:!1}]});let c=l.compile({type:"object",properties:{version:{type:"string",const:"1"},name:{type:"string",minLength:1,maxLength:100},steps:{type:"array",items:{$ref:"stepSchema"},minItems:1,maxItems:50}},required:["version","name","steps"],additionalProperties:!1});function p(e){return c(e)?{valid:!0,errors:[],data:e}:{valid:!1,errors:c.errors?.map(e=>{let t=e.instancePath||"root",r=e.message||"validation failed";if("required"===e.keyword){let r=e.params?.missingProperty;return`Missing required property "${r}" at ${t}`}if("enum"===e.keyword){let r=e.params?.allowedValues;return`Invalid value at ${t}. Must be one of: ${r?.join(", ")}`}if("const"===e.keyword){let r=e.params?.allowedValue;return`Invalid value at ${t}. Must be: ${r}`}if("minItems"===e.keyword){let r=e.params?.limit;return`Array at ${t} must have at least ${r} items`}if("maxItems"===e.keyword){let r=e.params?.limit;return`Array at ${t} must have no more than ${r} items`}if("minLength"===e.keyword){let r=e.params?.limit;return`String at ${t} must be at least ${r} characters long`}if("maxLength"===e.keyword){let r=e.params?.limit;return`String at ${t} must be no more than ${r} characters long`}return"oneOf"===e.keyword?`Invalid step type at ${t}. Must be one of: trigger.http, filter, branch, action.slack.postMessage, action.http.request, custom.action`:`${r} at ${t}`})||["Unknown validation error"]}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,70,471,984,696,586],()=>r(76109));module.exports=s})();