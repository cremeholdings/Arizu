"use strict";(()=>{var e={};e.id=187,e.ids=[187],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},35816:e=>{e.exports=require("process")},6162:e=>{e.exports=require("worker_threads")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},45974:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>d});var a=r(49303),o=r(88716),i=r(60670),n=r(87070),p=r(96471),l=r(21067),c=r(93953);let u=l.Ry({plan:l._4()});async function d(e){try{let{userId:t,orgId:r}=(0,p.I8)();if(!t||!r)return n.NextResponse.json({ok:!1,error:"Authentication required"},{status:401});let s=await e.json(),a=u.safeParse(s);if(!a.success)return n.NextResponse.json({ok:!1,error:"Invalid request",issues:a.error.issues.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});let{plan:o}=a.data;console.log("Plan validation request",{userId:t.slice(0,8)+"...",orgId:r.slice(0,8)+"...",planType:typeof o,hasSteps:o&&"object"==typeof o&&"steps"in o});let i=await (0,c.us)(o,{orgId:r});if(console.log("Plan validation completed",{userId:t.slice(0,8)+"...",orgId:r.slice(0,8)+"...",valid:i.valid,issueCount:i.issues.length,issueCodes:i.issues.map(e=>e.code)}),i.valid)return n.NextResponse.json({ok:!0,message:"Plan is valid and ready to use.",summary:(0,c.MD)(i)});let l=(0,c.mn)(i.issues);return n.NextResponse.json({ok:!1,error:"Plan validation failed",summary:(0,c.MD)(i),issues:i.issues,categorized:{critical:l.critical,warning:l.warning,info:l.info},suggestions:["Review the issues listed above and fix them one by one.","Critical issues must be resolved before the plan can be deployed.","Start with the first issue and work your way down the list."]},{status:422})}catch(e){return console.error("Plan validation API error",{error:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),n.NextResponse.json({ok:!1,error:"Internal server error",message:"An error occurred while validating the plan. Please try again."},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/validate/route",pathname:"/api/validate",filename:"route",bundlePath:"app/api/validate/route"},resolvedPagePath:"/Users/ediyaffe/Documents/GitHub/Arizu/app/api/validate/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:y}=h,f="/api/validate/route";function v(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},70907:(e,t,r)=>{r.d(t,{NH:()=>c});var s=r(19619),a=r.n(s),o=r(28586),i=r.n(o);let n={type:"object",properties:{field:{type:"string"},op:{type:"string",enum:["contains","equals","gt","lt","regex"]},value:{}},required:["field","op","value"],additionalProperties:!1},p=new(a())({allErrors:!0,verbose:!0,strict:!0,removeAdditional:!1});i()(p),p.addSchema({$id:"stepSchema",oneOf:[{type:"object",properties:{type:{type:"string",const:"trigger.http"},path:{type:"string"},secretHmac:{type:"boolean"}},required:["type","path","secretHmac"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"filter"},when:n},required:["type","when"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"action.slack.postMessage"},channel:{type:"string"},text:{type:"string"}},required:["type","channel","text"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"action.http.request"},method:{type:"string",enum:["GET","POST","PUT","DELETE"]},url:{type:"string"},headers:{type:"object",nullable:!0,additionalProperties:!0},body:{type:"object",nullable:!0,additionalProperties:!0}},required:["type","method","url"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"custom.action"},actionSlug:{type:"string"},input:{type:"object",nullable:!0,additionalProperties:!0}},required:["type","actionSlug"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"branch"},cases:{type:"array",items:{type:"object",properties:{when:n,steps:{type:"array",items:{$ref:"stepSchema"}}},required:["when","steps"],additionalProperties:!1},minItems:1},else:{type:"array",items:{$ref:"stepSchema"},nullable:!0}},required:["type","cases"],additionalProperties:!1}]});let l=p.compile({type:"object",properties:{version:{type:"string",const:"1"},name:{type:"string",minLength:1,maxLength:100},steps:{type:"array",items:{$ref:"stepSchema"},minItems:1,maxItems:50}},required:["version","name","steps"],additionalProperties:!1});function c(e){return l(e)?{valid:!0,errors:[],data:e}:{valid:!1,errors:l.errors?.map(e=>{let t=e.instancePath||"root",r=e.message||"validation failed";if("required"===e.keyword){let r=e.params?.missingProperty;return`Missing required property "${r}" at ${t}`}if("enum"===e.keyword){let r=e.params?.allowedValues;return`Invalid value at ${t}. Must be one of: ${r?.join(", ")}`}if("const"===e.keyword){let r=e.params?.allowedValue;return`Invalid value at ${t}. Must be: ${r}`}if("minItems"===e.keyword){let r=e.params?.limit;return`Array at ${t} must have at least ${r} items`}if("maxItems"===e.keyword){let r=e.params?.limit;return`Array at ${t} must have no more than ${r} items`}if("minLength"===e.keyword){let r=e.params?.limit;return`String at ${t} must be at least ${r} characters long`}if("maxLength"===e.keyword){let r=e.params?.limit;return`String at ${t} must be no more than ${r} characters long`}return"oneOf"===e.keyword?`Invalid step type at ${t}. Must be one of: trigger.http, filter, branch, action.slack.postMessage, action.http.request, custom.action`:`${r} at ${t}`})||["Unknown validation error"]}}},93953:(e,t,r)=>{r.d(t,{MD:()=>p,mn:()=>l,us:()=>n});var s=r(70907);async function a(e,t){return console.log(`TODO: Resolve action slug "${e}" for org ${t.slice(0,8)}...`),!1}function o(e,t){let r=`steps[${e}]`;return t?`${r}.${t}`:r}async function i(e,t,r,s){let n=[],p=s?`${s}.steps[${t}]`:o(t);if("custom.action"!==e.type||await a(e.actionSlug,r)||n.push({path:`${p}.actionSlug`,code:"UNKNOWN_ACTION_SLUG",message:`Custom action "${e.actionSlug}" is not available for your organization. Check the spelling or contact support to add this action.`}),"action.http.request"===e.type&&!function(e){try{let t=new URL(e).hostname.toLowerCase();return["api.slack.com","hooks.slack.com","api.github.com","api.salesforce.com","graph.microsoft.com","api.hubspot.com","api.stripe.com","api.zapier.com","jsonplaceholder.typicode.com"].some(e=>t===e||t.endsWith(`.${e}`))}catch{return!1}}(e.url)&&n.push({path:`${p}.url`,code:"FORBIDDEN_HOST",message:`HTTP requests to ${function(e){try{let t=new URL(e);return`${t.protocol}//${t.hostname}${t.pathname?"/...":""}`}catch{return"[INVALID_URL]"}}(e.url)} are not allowed. Contact support to allowlist this host.`}),"branch"===e.type){for(let t=0;t<e.cases.length;t++){let s=e.cases[t],a=`${p}.cases[${t}]`;if(s.steps&&0!==s.steps.length)for(let e=0;e<s.steps.length;e++){let t=await i(s.steps[e],e,r,a);n.push(...t)}else n.push({path:`${a}.steps`,code:"EMPTY_BRANCH_CASE",message:"Branch cases must contain at least one step. Add an action or remove this case."})}if(e.else){if(0===e.else.length)n.push({path:`${p}.else`,code:"EMPTY_BRANCH_ELSE",message:"Branch else clause cannot be empty. Add steps or remove the else clause."});else for(let t=0;t<e.else.length;t++){let s=await i(e.else[t],t,r,`${p}.else`);n.push(...s)}}}return n}async function n(e,t){let r=[],a=(0,s.NH)(e);if(!a.valid)return{valid:!1,issues:a.errors.map(e=>({path:"schema",code:"SCHEMA_VALIDATION_FAILED",message:e}))};let n=a.data;try{0===n.steps.length?r.push({path:"steps",code:"NO_STEPS",message:"Plan must contain at least one step."}):n.steps[0].type.startsWith("trigger.")||r.push({path:"steps[0].type",code:"MUST_START_WITH_TRIGGER",message:"Plan must start with a trigger step (e.g., trigger.http). Add a trigger as the first step."});for(let e=0;e<n.steps.length;e++){let s=await i(n.steps[e],e,t.orgId);r.push(...s)}n.steps.filter(e=>e.type.startsWith("trigger.")).length>1&&r.push({path:"steps",code:"MULTIPLE_TRIGGERS",message:"Plan can only have one trigger step. Remove extra trigger steps or create separate plans."}),n.steps.forEach((e,t)=>{"action.slack.postMessage"!==e.type||e.channel.startsWith("#")||e.channel.startsWith("@")||r.push({path:o(t,"channel"),code:"INVALID_SLACK_CHANNEL",message:`Slack channel must start with # for channels or @ for users. Got: "${e.channel}"`})}),n.steps.forEach((e,t)=>{"trigger.http"===e.type&&(e.path.startsWith("/")||r.push({path:o(t,"path"),code:"INVALID_WEBHOOK_PATH",message:`Webhook path must start with /. Got: "${e.path}"`}),(e.path.includes(" ")||e.path.includes("?"))&&r.push({path:o(t,"path"),code:"INVALID_WEBHOOK_PATH_FORMAT",message:`Webhook path cannot contain spaces or query parameters. Got: "${e.path}"`}))})}catch(e){console.error("Error during plan validation:",{orgId:t.orgId.slice(0,8)+"...",error:e instanceof Error?e.message:"Unknown error"}),r.push({path:"validation",code:"VALIDATION_ERROR",message:"An error occurred during plan validation. Please try again."})}return{valid:0===r.length,issues:r}}function p(e){if(e.valid)return"Plan is valid and ready to use.";let t=e.issues.length,r=e.issues.filter(e=>"SCHEMA_VALIDATION_FAILED"===e.code||"MUST_START_WITH_TRIGGER"===e.code).length;return r>0?`Plan has ${t} issue${t>1?"s":""} including ${r} critical error${r>1?"s":""}. Fix critical errors first.`:`Plan has ${t} issue${t>1?"s":""} that should be addressed before deployment.`}function l(e){let t=e.filter(e=>"SCHEMA_VALIDATION_FAILED"===e.code||"MUST_START_WITH_TRIGGER"===e.code||"NO_STEPS"===e.code||"EMPTY_BRANCH_CASE"===e.code),r=e.filter(e=>"UNKNOWN_ACTION_SLUG"===e.code||"FORBIDDEN_HOST"===e.code||"MULTIPLE_TRIGGERS"===e.code),s=e.filter(e=>!t.includes(e)&&!r.includes(e));return{critical:t,warning:r,info:s}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,70,471,696,586],()=>r(45974));module.exports=s})();