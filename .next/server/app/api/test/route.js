"use strict";(()=>{var e={};e.id=329,e.ids=[329],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},98216:e=>{e.exports=require("net")},35816:e=>{e.exports=require("process")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},90641:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>I,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>x,serverHooks:()=>q,staticGenerationAsyncStorage:()=>h});var r={};s.r(r),s.d(r,{POST:()=>g});var o=s(49303),i=s(88716),n=s(60670),a=s(87070),u=s(96471),l=s(21067),p=s(93953),d=s(91180),c=s(55227);let m=l.Ry({plan:l._4()});async function g(e){try{var t;let s;let{userId:r,orgId:o}=(0,u.I8)();if(!r||!o)return a.NextResponse.json({ok:!1,error:{code:"AUTHENTICATION_REQUIRED",message:"Authentication required"}},{status:401});let i=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"127.0.0.1",n=await (0,c.Iy)("PLAN_VALIDATE","/api/test",{ip:i,orgId:o,userId:r});if((0,c.V1)(n)){let e=(0,c.dK)(n);return console.warn("Plan test rate limited",{userId:r.slice(0,8)+"...",orgId:o.slice(0,8)+"...",ip:i,limit:e.limit,remaining:e.remaining,retryAfter:e.retryAfter}),a.NextResponse.json({ok:!1,error:{code:"RATE_LIMIT",message:"Rate limit exceeded",details:{limit:e.limit,remaining:e.remaining,resetTime:e.resetTime,suggestion:"Please wait before testing again"}}},{status:429,headers:{"Retry-After":String(e.retryAfter||60),"X-RateLimit-Limit":String(e.limit),"X-RateLimit-Remaining":String(e.remaining),"X-RateLimit-Reset":String(e.resetTime)}})}let l=await e.json(),g=m.safeParse(l);if(!g.success)return a.NextResponse.json({ok:!1,simulated:!1,error:{code:"INVALID_REQUEST",message:"Invalid request format",details:{issues:g.error.issues.map(e=>({field:e.path.join("."),message:e.message}))}}},{status:400});let{plan:x}=g.data;console.log("Plan test request",{userId:r.slice(0,8)+"...",orgId:o.slice(0,8)+"...",planType:typeof x});let f=await (0,p.us)(x,{orgId:o});if(!f.valid)return console.warn("Plan validation failed during test",{userId:r.slice(0,8)+"...",orgId:o.slice(0,8)+"...",issues:f.issues}),a.NextResponse.json({ok:!1,simulated:!1,error:(t=f.issues,{code:"PLAN_VALIDATION_FAILED",message:"Plan validation failed",details:{issues:t,suggestion:"Fix the validation issues and try again"}}),issues:f.issues.map(e=>e.message||String(e))},{status:422});try{s=(await (0,d.q)(x,{orgId:o})).workflow,console.log("Plan compilation successful during test",{userId:r.slice(0,8)+"...",orgId:o.slice(0,8)+"...",planName:x.name,stepCount:x.steps.length,nodeCount:s.nodes?.length||0})}catch(e){if(console.error("Plan compilation failed during test",{userId:r.slice(0,8)+"...",orgId:o.slice(0,8)+"...",planName:x.name,error:e instanceof Error?e.message:"Unknown error"}),e instanceof d.m)return a.NextResponse.json({ok:!1,simulated:!1,error:{code:e.code,message:e.message,details:{stepType:e.step?.type,suggestion:"Check your plan structure and step types"}},issues:[e.message]},{status:422});return a.NextResponse.json({ok:!1,simulated:!1,error:{code:"COMPILATION_ERROR",message:"Failed to compile plan to workflow",details:{error:e instanceof Error?e.message:"Unknown error",suggestion:"Check your plan structure and try again"}},issues:["Plan compilation failed"]},{status:500})}let h=[];0===x.steps.length&&h.push("Plan has no steps defined"),x.steps.some(e=>"webhook_trigger"===e.type)&&h.push("Webhook triggers require external testing"),x.steps.some(e=>"manual_trigger"===e.type)&&h.push("Manual triggers require user interaction"),x.steps.some(e=>["http_request","api_call","webhook"].includes(e.type))&&h.push("External API calls not tested in simulation");let q=Math.floor(3e3*Math.random())+500,I=Math.random()>.1;I||h.push("Simulated execution encountered an error"),console.log("Plan test completed",{userId:r.slice(0,8)+"...",orgId:o.slice(0,8)+"...",planName:x.name,success:I,duration:q,issueCount:h.length});let y={ok:I,simulated:!0,message:I?"Plan test completed successfully":"Plan test completed with issues",details:{planName:x.name,stepCount:x.steps.length,nodeCount:s.nodes?.length||0,simulatedDuration:q,timestamp:new Date().toISOString()},...h.length>0&&{issues:h}};return a.NextResponse.json(y)}catch(e){return console.error("Plan test API error",{error:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),a.NextResponse.json({ok:!1,simulated:!1,error:{code:"INTERNAL_ERROR",message:"Internal server error",details:{suggestion:"Please try again in a moment. If the problem persists, contact support."}}},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/test/route",pathname:"/api/test",filename:"route",bundlePath:"app/api/test/route"},resolvedPagePath:"/Users/ediyaffe/Documents/GitHub/Arizu/app/api/test/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:q}=x,I="/api/test/route";function y(){return(0,n.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:h})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,70,471,984,696,586,270],()=>s(90641));module.exports=r})();