"use strict";(()=>{var e={};e.id=348,e.ids=[348],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},98216:e=>{e.exports=require("net")},35816:e=>{e.exports=require("process")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},69281:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>C,patchFetch:()=>b,requestAsyncStorage:()=>P,routeModule:()=>A,serverHooks:()=>N,staticGenerationAsyncStorage:()=>I});var s={};r.r(s),r.d(s,{POST:()=>x});var o=r(49303),n=r(88716),a=r(60670),i=r(87070),l=r(96471),c=r(21067),u=r(93953),d=r(91180),h=r(39021),p=r(55227),m=r(60077),f=r(17081),w=r(60594);let g={free:{maxWorkflows:3,maxStepsPerWorkflow:5,maxMonthlyRuns:100,hasAdvancedConnectors:!1,hasCustomCode:!1,hasScheduledTriggers:!1,hasWebhookTriggers:!0,hasAPIAccess:!1,hasTeamCollaboration:!1,hasPrioritySupport:!1,hasAdvancedAnalytics:!1},starter:{maxWorkflows:10,maxStepsPerWorkflow:10,maxMonthlyRuns:1e3,hasAdvancedConnectors:!0,hasCustomCode:!1,hasScheduledTriggers:!0,hasWebhookTriggers:!0,hasAPIAccess:!0,hasTeamCollaboration:!1,hasPrioritySupport:!1,hasAdvancedAnalytics:!1},pro:{maxWorkflows:50,maxStepsPerWorkflow:25,maxMonthlyRuns:1e4,hasAdvancedConnectors:!0,hasCustomCode:!0,hasScheduledTriggers:!0,hasWebhookTriggers:!0,hasAPIAccess:!0,hasTeamCollaboration:!0,hasPrioritySupport:!0,hasAdvancedAnalytics:!0},enterprise:{maxWorkflows:-1,maxStepsPerWorkflow:-1,maxMonthlyRuns:-1,hasAdvancedConnectors:!0,hasCustomCode:!0,hasScheduledTriggers:!0,hasWebhookTriggers:!0,hasAPIAccess:!0,hasTeamCollaboration:!0,hasPrioritySupport:!0,hasAdvancedAnalytics:!0}};async function y(e){try{let t=await (0,f.S0)(e),r=g[t.planType]||g.free;if(-1===r.maxWorkflows)return;t.workflowsCount>=r.maxWorkflows&&(console.warn("Workflow limit exceeded",{orgId:e.slice(0,8)+"...",used:t.workflowsCount,limit:r.maxWorkflows,planType:t.planType}),(0,w.eQ)(`Workflow limit of ${r.maxWorkflows} exceeded. Current usage: ${t.workflowsCount}`,{limit:r.maxWorkflows,used:t.workflowsCount,planType:t.planType})),console.log("Workflow limit check passed",{orgId:e.slice(0,8)+"...",used:t.workflowsCount,limit:r.maxWorkflows,remaining:r.maxWorkflows-t.workflowsCount,planType:t.planType})}catch(t){if(t instanceof Error&&"TypedError"===t.name)throw t;console.error("Error checking workflow limit",{orgId:e.slice(0,8)+"...",error:t instanceof Error?t.message:"Unknown error"}),(0,w.eQ)("Failed to check workflow limits. Please try again.")}}async function k(e,t){try{let r=await (0,f.S0)(e),s=g[r.planType]||g.free;if(-1===s.maxStepsPerWorkflow)return;t>s.maxStepsPerWorkflow&&(console.warn("Workflow step limit exceeded",{orgId:e.slice(0,8)+"...",stepCount:t,limit:s.maxStepsPerWorkflow,planType:r.planType}),(0,w.eQ)(`Workflow step limit of ${s.maxStepsPerWorkflow} exceeded. Your workflow has ${t} steps`,{limit:s.maxStepsPerWorkflow,used:t,planType:r.planType})),console.log("Workflow step limit check passed",{orgId:e.slice(0,8)+"...",stepCount:t,limit:s.maxStepsPerWorkflow,planType:r.planType})}catch(t){if(t instanceof Error&&"TypedError"===t.name)throw t;console.error("Error checking step limit",{orgId:e.slice(0,8)+"...",error:t instanceof Error?t.message:"Unknown error"}),(0,w.eQ)("Failed to check step limits. Please try again.")}}async function E(e,t){try{let r=await (0,f.S0)(e),s=g[r.planType]||g.free;if(!s[t]){console.warn("Feature access denied",{orgId:e.slice(0,8)+"...",feature:t,planType:r.planType,hasFeature:s[t]});let o={maxWorkflows:"Workflow Limit",maxStepsPerWorkflow:"Step Limit",maxMonthlyRuns:"Monthly Run Limit",hasAdvancedConnectors:"Advanced Connectors",hasCustomCode:"Custom Code Execution",hasScheduledTriggers:"Scheduled Triggers",hasWebhookTriggers:"Webhook Triggers",hasAPIAccess:"API Access",hasTeamCollaboration:"Team Collaboration",hasPrioritySupport:"Priority Support",hasAdvancedAnalytics:"Advanced Analytics"}[t]||t.toString(),n=function(e){for(let[t,r]of Object.entries(g))if(r[e])return t;return"pro"}(t);(0,w.PP)(`${o} is not available on your current plan`,{feature:o,requiredPlan:n,currentPlan:r.planType})}console.log("Feature access check passed",{orgId:e.slice(0,8)+"...",feature:t,planType:r.planType,hasFeature:s[t]})}catch(r){if(r instanceof Error&&"TypedError"===r.name)throw r;console.error("Error checking feature access",{orgId:e.slice(0,8)+"...",feature:t,error:r instanceof Error?r.message:"Unknown error"}),(0,w.PP)("Failed to check feature access. Please try again.")}}async function R(e,t){if(t.steps&&Array.isArray(t.steps)&&await k(e,t.steps.length),t.steps)for(let r of t.steps)("custom_code"===r.type||r.config?.customCode)&&await E(e,"hasCustomCode"),("schedule_trigger"===r.type||"cron_trigger"===r.type)&&await E(e,"hasScheduledTriggers"),r.type&&function(e){return["salesforce","hubspot","zendesk","jira","confluence","marketo","pardot","dynamics","servicenow","workday","netsuite","oracle","sap","snowflake","databricks"].some(t=>e.toLowerCase().includes(t))}(r.type)&&await E(e,"hasAdvancedConnectors")}let T=c.Ry({plan:c._4(),workflowName:c.Z_().min(1).max(100)});async function x(e){try{let t,r;let{userId:s,orgId:o}=(0,l.I8)();if(!s||!o){let e=(0,w.Hs)();return i.NextResponse.json(e,{status:(0,w.rY)(e)})}let n=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"127.0.0.1",a=await (0,p.Iy)("DEPLOY","/api/deploy",{ip:n,orgId:o,userId:s});if((0,p.V1)(a)){let e=(0,p.dK)(a);console.warn("Deploy rate limited",{userId:s.slice(0,8)+"...",orgId:o.slice(0,8)+"...",ip:n,limit:e.limit,remaining:e.remaining,retryAfter:e.retryAfter});let t=(0,w.hb)("Rate limit exceeded. Please wait before deploying again.",e.retryAfter||60,{retryAfterSec:e.retryAfter||60,resetTime:e.resetTime,endpoint:"/api/deploy"});return i.NextResponse.json(t,{status:(0,w.rY)(t),headers:{"Retry-After":String(e.retryAfter||60),"X-RateLimit-Limit":String(e.limit),"X-RateLimit-Remaining":String(e.remaining),"X-RateLimit-Reset":String(e.resetTime)}})}let c=await e.json(),f=T.safeParse(c);if(!f.success)return i.NextResponse.json({ok:!1,error:{code:"INVALID_REQUEST",message:"Invalid request format",details:{issues:f.error.issues.map(e=>({field:e.path.join("."),message:e.message}))}}},{status:400});let{plan:g,workflowName:k}=f.data;console.log("Deployment request",{userId:s.slice(0,8)+"...",orgId:o.slice(0,8)+"...",workflowName:k,planType:typeof g});let E=await (0,u.us)(g,{orgId:o});if(!E.valid){console.warn("Plan validation failed during deploy",{userId:s.slice(0,8)+"...",orgId:o.slice(0,8)+"...",workflowName:k,issues:E.issues});let e=(0,w.Bp)("Plan validation failed",E.issues);return i.NextResponse.json(e,{status:(0,w.rY)(e)})}await y(o),await R(o,g);try{t=(await (0,d.q)(g,{orgId:o})).workflow}catch(t){if(console.error("Plan compilation failed during deploy",{userId:s.slice(0,8)+"...",orgId:o.slice(0,8)+"...",workflowName:k,error:t instanceof Error?t.message:"Unknown error"}),t instanceof d.m){let e=(0,w.Uf)(t.message,{stepType:t.step?.type,suggestion:"Check your plan structure and step types"});return i.NextResponse.json(e,{status:(0,w.rY)(e)})}let e=(0,w.Uf)("Failed to compile plan to workflow",{error:t instanceof Error?t.message:"Unknown error",suggestion:"Check your plan structure and try again"});return i.NextResponse.json(e,{status:(0,w.rY)(e)})}try{r=await (0,m.lI)(`n8n-deploy-${o}`,"N8N_API",async()=>{let e=(0,h.Pe)();if(!await e.healthCheck())throw new h.Bv(0,"N8n instance is not reachable");let r=await e.upsertByName(k,t);return await e.activateWorkflow(r.workflowId,!0),r}),console.log("Workflow deployed successfully",{userId:s.slice(0,8)+"...",orgId:o.slice(0,8)+"...",workflowName:k,workflowId:r.workflowId,isNew:r.isNew,hasWebhook:!!r.webhookUrl})}catch(e){if(console.error("N8n deployment failed",{userId:s.slice(0,8)+"...",orgId:o.slice(0,8)+"...",workflowName:k,error:e instanceof Error?e.message:"Unknown error"}),e instanceof h.Bv)return i.NextResponse.json({ok:!1,error:function(e){let t={code:"N8N_API_ERROR",message:`N8n deployment failed: ${e.message}`,details:{status:e.status,suggestion:"Check your N8n instance configuration and try again"}};return 401===e.status?{...t,code:"N8N_UNAUTHORIZED",message:"N8n API authentication failed",details:{...t.details,suggestion:"Check your N8N_API_KEY configuration"}}:404===e.status?{...t,code:"N8N_NOT_FOUND",message:"N8n API endpoint not found",details:{...t.details,suggestion:"Check your N8N_URL configuration and ensure n8n is running"}}:e.status>=500?{...t,code:"N8N_SERVER_ERROR",message:"N8n server error",details:{...t.details,suggestion:"Check n8n server logs and try again"}}:t}(e)},{status:e.status>=400&&e.status<500?e.status:500});return i.NextResponse.json({ok:!1,error:{code:"DEPLOYMENT_ERROR",message:"Failed to deploy workflow to n8n",details:{error:e instanceof Error?e.message:"Unknown error",suggestion:"Check n8n configuration and try again"}}},{status:500})}return i.NextResponse.json({ok:!0,workflowId:r.workflowId,workflowName:k,webhookUrl:r.webhookUrl,isNew:r.isNew,message:r.isNew?"Workflow created and activated":"Workflow updated and activated"})}catch(t){if(t instanceof w.hr){console.warn("Deploy API typed error",{code:t.response.code,message:t.response.message,meta:t.response.meta});let e=t.response,r={};return e.retryAfterSec&&(r["Retry-After"]=String(e.retryAfterSec)),i.NextResponse.json(e,{status:(0,w.rY)(e),headers:Object.keys(r).length>0?r:void 0})}console.error("Deploy API error",{error:t instanceof Error?t.message:"Unknown error",stack:t instanceof Error?t.stack:void 0});let e=(0,w.I3)("Internal server error. Please try again in a moment.");return i.NextResponse.json(e,{status:(0,w.rY)(e)})}}let A=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/deploy/route",pathname:"/api/deploy",filename:"route",bundlePath:"app/api/deploy/route"},resolvedPagePath:"/Users/ediyaffe/Documents/GitHub/Arizu/app/api/deploy/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:P,staticGenerationAsyncStorage:I,serverHooks:N}=A,C="/api/deploy/route";function b(){return(0,a.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:I})}},9487:(e,t,r)=>{r.d(t,{db:()=>o});var s=r(53524);let o=globalThis.prisma??new s.PrismaClient({log:["query"]})},60594:(e,t,r)=>{function s(e,t,r){return{ok:!1,code:"RATE_LIMIT",message:e,retryAfterSec:t||r?.retryAfterSec,meta:r}}function o(e="Authentication required",t){return{ok:!1,code:"UNAUTHORIZED",message:e,meta:t}}function n(e="Internal server error",t){return{ok:!1,code:"SERVER_ERROR",message:e,meta:t}}function a(e,t,r){return{ok:!1,code:"VALIDATION_ERROR",message:e,meta:{...r,issues:t}}}function i(e,t){return{ok:!1,code:"COMPILATION_ERROR",message:e,meta:t}}r.d(t,{Bp:()=>a,Hs:()=>o,I3:()=>n,PP:()=>u,Uf:()=>i,eQ:()=>c,hb:()=>s,hr:()=>l,rY:()=>d});class l extends Error{constructor(e){super(e.message),this.response=e,this.name="TypedError"}static isPlanLimit(e){return e instanceof l&&"PLAN_LIMIT"===e.response.code}static isFeatureLocked(e){return e instanceof l&&"FEATURE_LOCKED"===e.response.code}static isRateLimit(e){return e instanceof l&&"RATE_LIMIT"===e.response.code}static isCircuitOpen(e){return e instanceof l&&"CIRCUIT_OPEN"===e.response.code}static isBadRequest(e){return e instanceof l&&"BAD_REQUEST"===e.response.code}static isUnauthorized(e){return e instanceof l&&"UNAUTHORIZED"===e.response.code}static isForbidden(e){return e instanceof l&&"FORBIDDEN"===e.response.code}static isNotFound(e){return e instanceof l&&"NOT_FOUND"===e.response.code}static isServerError(e){return e instanceof l&&"SERVER_ERROR"===e.response.code}}function c(e,t){throw new l({ok:!1,code:"PLAN_LIMIT",message:e,meta:t})}function u(e,t){throw new l({ok:!1,code:"FEATURE_LOCKED",message:e,meta:t})}function d(e){switch(e.code){case"BAD_REQUEST":case"VALIDATION_ERROR":return 400;case"UNAUTHORIZED":return 401;case"FORBIDDEN":case"PLAN_LIMIT":case"FEATURE_LOCKED":return 403;case"NOT_FOUND":return 404;case"COMPILATION_ERROR":return 422;case"RATE_LIMIT":return 429;case"SERVER_ERROR":default:return 500;case"CIRCUIT_OPEN":return 503}}},60077:(e,t,r)=>{var s;r.d(t,{ZN:()=>o,lI:()=>l}),function(e){e.CLOSED="closed",e.OPEN="open",e.HALF_OPEN="half-open"}(s||(s={}));class o extends Error{constructor(e,t,r){super(e),this.state=t,this.lastError=r,this.name="CircuitBreakerError"}}class n{constructor(e,t){this.name=e,this.config=t,this.state="closed",this.failures=0,this.requests=0,this.lastFailureTime=0,this.nextAttemptTime=0,this.recentErrors=[]}async execute(e){let t=Date.now(),r=0;for(;r<this.config.maxRetries;){r++;try{await this.checkState();let s=await this.executeWithTimeout(e);return this.onSuccess(),console.log("Circuit breaker success:",{name:this.name,state:this.state,attempts:r,totalTime:Date.now()-t}),s}catch(s){if(this.onFailure(s),"open"===this.state||r>=this.config.maxRetries)throw console.error("Circuit breaker failure:",{name:this.name,state:this.state,attempts:r,totalTime:Date.now()-t,error:s instanceof Error?s.message:"Unknown error"}),s;let e=this.calculateRetryDelay(r);await this.sleep(e),console.warn("Circuit breaker retry:",{name:this.name,attempt:r,delay:e,error:s instanceof Error?s.message:"Unknown error"})}}throw new o(`Circuit breaker ${this.name} failed after ${r} attempts`,this.state)}async checkState(){let e=Date.now();switch(this.state){case"closed":if(this.cleanupOldErrors(e),this.requests>=this.config.minimumRequests){let t=this.failures/this.requests;if(t>=this.config.errorPercentageThreshold/100)throw this.transitionToOpen(e),new o(`Circuit breaker ${this.name} opened due to high error rate: ${(100*t).toFixed(1)}%`,"open")}break;case"open":if(e>=this.nextAttemptTime)this.transitionToHalfOpen();else{let t=this.nextAttemptTime-e;throw new o(`Circuit breaker ${this.name} is open. Next attempt in ${t}ms`,"open")}}}async executeWithTimeout(e){let t=new Promise((e,t)=>{setTimeout(()=>{t(Error(`Operation timeout after ${this.config.resetTimeoutMs}ms`))},this.config.resetTimeoutMs)});return Promise.race([e(),t])}onSuccess(){this.requests++,"half-open"===this.state&&this.transitionToClosed(),this.cleanupOldErrors(Date.now()),console.log("Circuit breaker request success:",{name:this.name,state:this.state,requests:this.requests,failures:this.failures})}onFailure(e){let t=Date.now();this.requests++,this.failures++,this.lastFailureTime=t,this.recentErrors.push({timestamp:t,error:e instanceof Error?e.message:"Unknown error"}),this.recentErrors=this.recentErrors.slice(-10),"half-open"===this.state&&this.transitionToOpen(t),console.warn("Circuit breaker request failure:",{name:this.name,state:this.state,requests:this.requests,failures:this.failures,error:e instanceof Error?e.message:"Unknown error"})}transitionToOpen(e){this.state="open",this.nextAttemptTime=e+this.config.resetTimeoutMs,console.warn("Circuit breaker opened:",{name:this.name,failures:this.failures,requests:this.requests,errorRate:(this.failures/this.requests*100).toFixed(1)+"%",nextAttemptTime:new Date(this.nextAttemptTime).toISOString()})}transitionToHalfOpen(){this.state="half-open",console.log("Circuit breaker transitioning to half-open:",{name:this.name,failures:this.failures,requests:this.requests})}transitionToClosed(){this.state="closed",this.failures=0,this.requests=0,this.recentErrors=[],console.log("Circuit breaker closed:",{name:this.name,resetSuccessful:!0})}cleanupOldErrors(e){let t=e-this.config.monitoringPeriodMs;this.recentErrors=this.recentErrors.filter(e=>e.timestamp>t);let r=this.failures;this.failures=this.recentErrors.length,0===this.recentErrors.length&&(this.requests=0),r!==this.failures&&console.log("Circuit breaker cleaned up old errors:",{name:this.name,oldFailures:r,newFailures:this.failures,requests:this.requests})}calculateRetryDelay(e){return Math.min(this.config.baseDelayMs*Math.pow(2,e-1),this.config.maxDelayMs)+Math.random()*this.config.jitterMs}sleep(e){return new Promise(t=>setTimeout(t,e))}getState(){return{state:this.state,failures:this.failures,requests:this.requests,lastFailureTime:this.lastFailureTime,nextAttemptTime:this.nextAttemptTime,recentErrors:[...this.recentErrors]}}getHealthCheck(){let e=this.requests>0?this.failures/this.requests*100:0,t="closed"===this.state&&e<this.config.errorPercentageThreshold,r="open"!==this.state;return{healthy:t,state:this.state,errorRate:e,uptime:r}}forceOpen(){this.state="open",this.nextAttemptTime=Date.now()+this.config.resetTimeoutMs,console.warn("Circuit breaker manually forced open:",{name:this.name})}forceClose(){this.transitionToClosed(),console.log("Circuit breaker manually forced closed:",{name:this.name})}reset(){this.transitionToClosed(),console.log("Circuit breaker reset:",{name:this.name})}}let a={LLM_API:{failureThreshold:5,resetTimeoutMs:3e4,monitoringPeriodMs:6e4,minimumRequests:3,errorPercentageThreshold:50,maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4,jitterMs:500},N8N_API:{failureThreshold:3,resetTimeoutMs:15e3,monitoringPeriodMs:6e4,minimumRequests:2,errorPercentageThreshold:30,maxRetries:2,baseDelayMs:500,maxDelayMs:5e3,jitterMs:250},DATABASE:{failureThreshold:10,resetTimeoutMs:1e4,monitoringPeriodMs:3e4,minimumRequests:5,errorPercentageThreshold:20,maxRetries:3,baseDelayMs:100,maxDelayMs:2e3,jitterMs:100},EXTERNAL_API:{failureThreshold:5,resetTimeoutMs:2e4,monitoringPeriodMs:6e4,minimumRequests:3,errorPercentageThreshold:40,maxRetries:2,baseDelayMs:1e3,maxDelayMs:8e3,jitterMs:500}},i=new Map;async function l(e,t,r){let s=function(e,t){if(!i.has(e)){let r=a[t];i.set(e,new n(e,r))}return i.get(e)}(e,t);return await s.execute(r)}},39021:(e,t,r)=>{r.d(t,{Bv:()=>s,Pe:()=>n,kN:()=>o});class s extends Error{constructor(e,t,r){super(t),this.status=e,this.response=r,this.name="N8nError"}}class o{constructor(e){this.apiBasePath=null,this.baseURL=e.baseURL.replace(/\/$/,""),this.apiKey=e.apiKey}async request(e,t,r){this.apiBasePath||await this.detectApiBasePath();let o=`${this.baseURL}${this.apiBasePath}${t}`,n={"X-N8N-API-KEY":this.apiKey,"Content-Type":"application/json"};console.log(`N8n API request: ${e} ${t}`,{url:o.replace(this.apiKey,"[REDACTED]"),hasBody:!!r,bodySize:r?JSON.stringify(r).length:0});try{let a;let i=await fetch(o,{method:e,headers:n,body:r?JSON.stringify(r):void 0}),l=await i.text();try{a=l?JSON.parse(l):null}catch{a={raw:l}}if(!i.ok)throw console.error("N8n API error",{status:i.status,statusText:i.statusText,url:o.replace(this.apiKey,"[REDACTED]"),response:a}),new s(i.status,`N8n API error (${i.status}): ${a?.message||i.statusText}`,a);return console.log(`N8n API response: ${e} ${t}`,{status:i.status,hasData:!!a,dataSize:l.length}),a}catch(e){if(e instanceof s)throw e;throw console.error("N8n API request failed",{error:e instanceof Error?e.message:"Unknown error",url:o.replace(this.apiKey,"[REDACTED]")}),new s(0,`N8n API request failed: ${e instanceof Error?e.message:"Unknown error"}`)}}async detectApiBasePath(){for(let e of["/api/v1","/rest"])try{this.apiBasePath=e,await this.getVersion(),console.log(`N8n API base path detected: ${e}`);return}catch(t){console.log(`N8n API path ${e} failed, trying next...`);continue}throw new s(0,"Could not detect N8n API base path. Tried /api/v1 and /rest. Check your N8n installation and API configuration.")}async getVersion(){return this.request("GET","/")}async listWorkflows(){return(await this.request("GET","/workflows")).data||[]}async getWorkflow(e){return this.request("GET",`/workflows/${e}`)}async createWorkflow(e){return this.request("POST","/workflows",e)}async updateWorkflow(e,t){return this.request("PUT",`/workflows/${e}`,t)}async activateWorkflow(e,t){return this.request("PATCH",`/workflows/${e}`,{active:t})}async deleteWorkflow(e){await this.request("DELETE",`/workflows/${e}`)}async upsertByName(e,t){try{let r;let s=(await this.listWorkflows()).find(t=>t.name===e),o={name:t.name||e,nodes:t.nodes,connections:t.connections,active:!1,settings:{timezone:"America/New_York",saveDataErrorExecution:"all",saveDataSuccessExecution:"all",saveManualExecutions:!0},tags:["arizu-generated"]},n=!1;s?(console.log(`Updating existing workflow: ${e} (${s.id})`),r=await this.updateWorkflow(s.id,o)):(console.log(`Creating new workflow: ${e}`),r=await this.createWorkflow(o),n=!0);let a=this.extractWebhookUrl(r);return{workflowId:r.id,isNew:n,webhookUrl:a}}catch(t){if(console.error("Failed to upsert workflow",{name:e,error:t instanceof Error?t.message:"Unknown error"}),t instanceof s)throw t;throw new s(0,`Failed to upsert workflow "${e}": ${t instanceof Error?t.message:"Unknown error"}`)}}extractWebhookUrl(e){try{let t=e.nodes?.find(e=>"n8n-nodes-base.webhook"===e.type&&e.webhookId);if(t&&t.parameters?.path){let e=t.parameters.path,r=this.baseURL.replace(/\/api.*$/,"");return`${r}/webhook${e}`}return}catch(e){console.warn("Failed to extract webhook URL",{error:e instanceof Error?e.message:"Unknown error"});return}}async getWorkflowByName(e){try{return(await this.listWorkflows()).find(t=>t.name===e)||null}catch(t){return console.error("Failed to get workflow by name",{name:e,error:t instanceof Error?t.message:"Unknown error"}),null}}async healthCheck(){try{return await this.getVersion(),!0}catch(e){return console.error("N8n health check failed",{baseURL:this.baseURL,error:e instanceof Error?e.message:"Unknown error"}),!1}}}function n(){let e=process.env.N8N_URL,t=process.env.N8N_API_KEY;if(!e)throw Error("N8N_URL environment variable is required");if(!t)throw Error("N8N_API_KEY environment variable is required");return new o({baseURL:e,apiKey:t})}},17081:(e,t,r)=>{r.d(t,{Nv:()=>a,QJ:()=>i,S0:()=>c,fE:()=>h,qL:()=>p});var s=r(9487);let o={FREE:{features:["basic_automations","email_notifications","community_support"]},PRO:{features:["basic_automations","advanced_triggers","webhooks","email_notifications","slack_integration","priority_support","analytics_basic"]},TEAM:{features:["basic_automations","advanced_triggers","webhooks","email_notifications","slack_integration","team_collaboration","user_management","priority_support","analytics_advanced","custom_branding"]},ENTERPRISE:{features:["basic_automations","advanced_triggers","webhooks","email_notifications","slack_integration","team_collaboration","user_management","code_steps","custom_integrations","sso","audit_logs","dedicated_support","analytics_enterprise","custom_branding","sla_guarantee"]}},n={FREE:{monthlyRuns:100,workflows:3,actionsAllowed:5,codeSteps:!1},PRO:{monthlyRuns:1e4,workflows:50,actionsAllowed:20,codeSteps:!1},TEAM:{monthlyRuns:5e4,workflows:200,actionsAllowed:50,codeSteps:!0},ENTERPRISE:{monthlyRuns:5e5,workflows:1e3,actionsAllowed:100,codeSteps:!0}},a={FREE:{key:"FREE",name:"Free",description:"Perfect for getting started with automation",price:{monthly:0,yearly:0},features:o.FREE.features,limits:n.FREE},PRO:{key:"PRO",name:"Pro",description:"For individuals and small teams",price:{monthly:29,yearly:290},features:o.PRO.features,limits:n.PRO,popular:!0},TEAM:{key:"TEAM",name:"Team",description:"For growing teams and businesses",price:{monthly:99,yearly:990},features:o.TEAM.features,limits:n.TEAM},ENTERPRISE:{key:"ENTERPRISE",name:"Enterprise",description:"For large organizations with advanced needs",price:{monthly:299,yearly:2990},features:o.ENTERPRISE.features,limits:n.ENTERPRISE}};async function i(e){try{let t=await s.db.organization.findUnique({where:{clerkId:e},select:{planType:!0}});if(!t)throw Error(`Organization not found: ${e}`);return function(e){switch(e){case"FREE":default:return"FREE";case"PRO":case"STARTER":return"PRO";case"ENTERPRISE":return"ENTERPRISE"}}(t.planType)}catch(t){return console.error("Error getting plan for organization:",{orgId:e.slice(0,8)+"...",error:t instanceof Error?t.message:"Unknown error"}),"FREE"}}function l(){let e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}async function c(e){try{let[t,r,s]=await Promise.all([i(e),u(e),d(e)]),o=n[t];return{monthlyRunsUsed:r.monthlyRunsUsed,monthlyRunsLimit:o.monthlyRuns,workflowsCount:s,workflowsLimit:o.workflows,actionsLimit:o.actionsAllowed,hasCodeSteps:o.codeSteps}}catch(t){return console.error("Error getting current usage:",{orgId:e.slice(0,8)+"...",error:t instanceof Error?t.message:"Unknown error"}),{monthlyRunsUsed:0,monthlyRunsLimit:0,workflowsCount:0,workflowsLimit:0,actionsLimit:0,hasCodeSteps:!1}}}async function u(e){let t=l();return await s.db.usageCounter.upsert({where:{organizationId_periodKey:{organizationId:e,periodKey:t}},update:{},create:{organizationId:e,periodKey:t,monthlyRunsUsed:0,monthlyRunsLimit:0,workflowsCount:0}})}async function d(e){return await s.db.automation.count({where:{organizationId:e,isActive:!0}})}async function h(e,t=1){let r=l();await s.db.usageCounter.upsert({where:{organizationId_periodKey:{organizationId:e,periodKey:r}},update:{monthlyRunsUsed:{increment:t}},create:{organizationId:e,periodKey:r,monthlyRunsUsed:t,monthlyRunsLimit:0,workflowsCount:0}})}function p(e){let t=["FREE","PRO","TEAM","ENTERPRISE"],r=t.indexOf(e);return -1===r||r===t.length-1?null:t[r+1]}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,70,471,984,696,586,270],()=>r(69281));module.exports=s})();